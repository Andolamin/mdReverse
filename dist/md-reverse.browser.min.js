!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MdReverse=t():e.MdReverse=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var l=t[r]={i:r,l:!1,exports:{}};return e[r].call(l.exports,l,l.exports,n),l.l=!0,l.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(r,l,function(t){return e[t]}.bind(null,l));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const r={Array:"[object Array]",Boolean:"[object Boolean]",BigInt:"[object BigInt]",Date:"[object Date]",Error:"[object Error]",Function:"[object Function]",Number:"[object Number]",Null:"[object Null]",Math:"[object Math]",Object:"[object Object]",RegExp:"[object RegExp]",String:"[object String]",Symbol:"[object Symbol]",Undefined:"[object Undefined]",UnKnown:"[object Unknown]"};function l(){}function i(e,t=0,n=e.length-1){const r=f.whitespace;for(;r.test(e[t])&&t<=n;)t++;for(;r.test(e[n])&&n>=t;)n--;return t>n?"":e.slice(t,n+1)}function o(e){return Object.prototype.toString.call(e)}function u(e){let t,n,r,l;return t=e.lastIndexOf(a.CR),l=(n=e.lastIndexOf(a.LF))-t,(r=t>n?t:n)===e.length-1&&(Math.abs(l)>1||-1===l?{type:r===t?"CR":"LF"}:1===l&&{type:"CRLF"})}Object.defineProperties(l.prototype,{trim:{value:i},isEmpty:{value:function(e,t=0,n=e.length-1){const r=f.whitespace;for(;t<=n;t++)if(!r.test(e[t]))return!1;return!0}},hasWhiteSpace:{value:function(e,t=0,n=e.length-1){const r=f.whitespace;let l=t,i=n;for(;r.test(e[t])&&l<=i;)l++;for(;r.test(e[n])&&i>=l;)i--;return{headNum:l-t,tailNum:n-i,start:l,end:i}}},compressWs:{value:function(e){const t=f.whitespace;let n=t.test(e[0]),r=t.test(e[e.length-1]);return e=i(e),`${n?" ":""}${e}${r?" ":""}`}},TYPE:{value:r},typeOf:{value:o},typeIs:{value:function(e,...t){const n=o(e);for(let e=t.length;e--;)if(n===t[e])return!0;return!1}},lastHasLS:{value:u},removeLastLS:{value:function(e){switch(u(e).type){case"CR":case"LF":e=e.slice(0,-1);break;case"CRLF":e=e.slice(0,-2)}return e}},formatCSS:{value:function(e){let t,n={};if(o(e)===r.String){t=e.split(/[:;]/);for(let e=0,r=t.length;e<r;e+=2)n[i(t[e])]=i(t[e+1]);return n}return new Error("cssText not String type")}}});var c=new l;const a={CR:"\r",LF:"\n",CRLF:"\r\n"},d=a.LF,f={whitespace:/\s/,tag:/<\S+>/g,attribute:/[a-zA-Z0-9\-]+="[^"]+"/g,escapeMdChar:/([\\`*_{}\[\]()#+\-.!])/g,unescapeHTMLEntry:/&(amp|lt|gt|quot|nbsp);/g,LineSeparator:{}},s={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&nbsp;":" "};let p={index:54},h={index:17},b={rootNode:-4,htmlNode:-2,all_element:0,a:2,h:4,p:6,em:8,li:10,ol:12,ul:14,div:16,pre:18,code:20,span:22,audio:24,aside:26,video:28,strong:30,script:32,button:34,article:36,blockquote:38,h1:40,h2:42,h3:44,h4:46,h5:48,h6:50,figure:52,figcaption:54,textNode:1,br:3,hr:5,img:7,link:9,"!--":11,input:13,meta:15,"!----":17};const R={defaultToken:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return""},endRule:function(e){return"\n"}},doubleToken:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return""},endRule:function(e){return""}},singleToken:{filterRule:{attribute:[],children:[]},convertRule:function(e){return""},endRule:function(e){return""}}},g={[b.rootNode]:R.doubleToken,[b.htmlNode]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return`<${e.tag}>`},endRule:function(e){return`</${e.tag}>\n`}},[b.textNode]:{filterRule:{attribute:[],children:[]},convertRule:function(e){let t=e.content;return t=t.replace(f.unescapeHTMLEntry,function(e){return s[e]||""}),e.parentNode.type===b.strong?t=c.trim(t):e.isCode||(t=c.compressWs(t)),t},endRule:function(e){return""}},[b.a]:{filterRule:{attribute:["href","title"],children:[b.all_element]},convertRule:function(){return"["},endRule:function(e){const t=e.attribute;return`](${t.href||""}`+(t.title?` "${t.title}"`:"")+")"}},[b.h]:R.doubleToken,[b.p]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return e.child_pre||""},endRule:function(e){return"\n\n"}},[b.em]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return"*"},endRule:function(e){return"*"}},[b.li]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return(e.child_pre||"")+(e.parentNode.type===b.ol?`${e.index+1}. `:"* ")},endRule:function(e){return"\n"}},[b.ol]:{filterRule:{attribute:[],children:[b.all_element]},childNodeRule:{pre:function(e){return e.parentNode.type===b.li?"    ":""}},convertRule:function(e){return`${e.parentNode.type===b.li?"\n":""}`},endRule:function(e){return""}},[b.ul]:{filterRule:{attribute:[],children:[b.all_element]},childNodeRule:{pre:function(e){return e.parentNode.type===b.li?"    ":""}},convertRule:function(e){return`${e.parentNode.type===b.li?"\n":""}`},endRule:function(e){return""}},[b.div]:R.defaultToken,[b.pre]:{filterRule:{attribute:[],children:[b.code,b.span]},convertRule:function(e){return"```\n"},endRule:function(e){return"\n```\n"}},[b.code]:{filterRule:{attribute:[],children:{include:[b.textNode],filter:!0}},convertRule:function(e){return`${e.parentNode.type===b.pre?"":"`"}`},endRule:function(e){return`${e.parentNode.type===b.pre?"":"`"}`}},[b.span]:R.doubleToken,[b.audio]:R.doubleToken,[b.aside]:R.doubleToken,[b.video]:R.doubleToken,[b.strong]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return" **"},endRule:function(e){return"** "}},[b.script]:R.doubleToken,[b.button]:R.doubleToken,[b.article]:R.doubleToken,[b.blockquote]:{filterRule:{attribute:[],children:[b.all_element]},childNodeRule:{pre:function(e){return">   "},post:function(e,t,n){return(t.type!==b.blockquote||t.isLast)&&(n=c.removeLastLS(n)),t.isLast&&(n=c.removeLastLS(n)),n}},convertRule:function(e){return""},endRule:function(e){let t=d,n=e.parentNode.children[e.index+1];return n&&n.type===b.blockquote||(t+=d),t}},[b.h1]:{filterRule:{attribute:["id"],children:{include:[b.textNode],filter:!0}},convertRule:function(e){return"# "},endRule:function(e){let t,n=e.attribute.id;return t=c.typeOf(n)===c.TYPE.String&&n.length>0?` {#${e.attribute.id}}\n`:"\n"}},[b.h2]:{filterRule:{attribute:["id"],children:{include:[b.textNode],filter:!0}},convertRule:function(e){return"## "},endRule:function(e){let t,n=e.attribute.id;return t=c.typeOf(n)===c.TYPE.String&&n.length>0?` {#${e.attribute.id}}\n`:"\n"}},[b.h3]:{filterRule:{attribute:["id"],children:{include:[b.textNode],filter:!0}},convertRule:function(e){return"### "},endRule:function(e){let t,n=e.attribute.id;return t=c.typeOf(n)===c.TYPE.String&&n.length>0?` {#${e.attribute.id}}\n`:"\n"}},[b.h4]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return"#### "},endRule:function(e){return"\n"}},[b.h5]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return"##### "},endRule:function(e){return"\n"}},[b.h6]:{filterRule:{attribute:[],children:[b.all_element]},convertRule:function(e){return"###### "},endRule:function(e){return"\n"}},[b.figure]:R.doubleToken,[b.figcaption]:R.doubleToken,[b.br]:{filterRule:{attribute:[],children:[]},convertRule:function(e){return"\n"},endRule:function(e){return""}},[b.hr]:{filterRule:{attribute:[],children:[]},convertRule:function(e){return"---\n"},endRule:function(e){return""}},[b.img]:{filterRule:{attribute:[{name:"src",alias:["data-src"]},{name:"title"}],children:[]},convertRule:function(e){return"!["},endRule:function(e){const t=e.attribute;return`](${t.src||""} "${t.title||""}")\n`}},[b.link]:R.singleToken,[b["!--"]]:R.singleToken,[b.input]:R.singleToken,[b.meta]:R.singleToken,[b["!----"]]:R.singleToken},y={excludeElement:{[b["!--"]]:{option:2},[b["!----"]]:{option:2},[b.htmlNode]:{option:2}}};function m(e,t=!0,n){let r=t?p:h;return n=n||(t?R.doubleToken:R.singleToken),r.index+=2,b[e]?new Error(`HTMLElement: ${e} already exist!`):(b[e]=r.index,g[b[e]]=n,!0)}function v(){}function N(){}function k(){}function _(e,t){if(!t||t.length<=0)return null;const n=e.match(f.attribute)||[];console.log(n);let r,l={};for(let e=n.length;e--;){r=n[e].split("=");for(let e,n=t.length;n--;){e=t[n];let i=c.typeOf(e);if(i===c.TYPE.String){if(e===r[0]){l[r[0]]=r[1].slice(1,r[1].length-1);break}}else if(i===c.TYPE.Object&&(e.name===r[0]||e.alias&&e.alias.includes(r[0]))){l[r[0]]=r[1].slice(1,r[1].length-1);break}}}return l}function x(e){let t="/"===e[1]?2:1,n=e.indexOf("<"),r=e[n];for(;r&&" "!==r&&">"!==r;)r=e[++n];return r?{start:t,end:n}:null}function T(){}function j(e,t,n){let r,l=n;return Array.isArray(n)||(l=n.include,r=n.filter),!(!l.includes(b.all_element)&&!l.includes(t.type))||(function(e,t,n,r=!1){let l,i=0,o=e.length,u=o;if(r){for(let r=e.length;r--;)if(l=e[r],o=r+1,n.includes(l.type)&&(e.splice(o,u-o),u=r),l.type===t.type)if(1===l.position)i++;else{if(0===i){e.splice(r,u-r);break}i--}}else for(let n=e.length;n--;)if((l=e[n]).type===t.type)if(1===l.position)i++;else if(0===i){e.splice(n);break}}(e,t,l,r),!1)}function w(){}function S(e,t){let n=g[e.type],r=e.parentNode,l=r&&g[r.type];switch(t){case"head":let i=void 0;return r&&r.child_pre&&(i=r.child_pre),n.childNodeRule&&n.childNodeRule.pre&&(i=(void 0===i?"":i)+n.childNodeRule.pre(e)),i&&(e.child_pre=i),n.convertRule(e);case"tail":let o=n.endRule(e);return l&&l.childNodeRule&&l.childNodeRule.post&&(o=l.childNodeRule.post(r,e,o)),o;case"headtail":default:return n.convertRule(e)+n.endRule(e)}}function E(){this.HTML=""}v.prototype.plugin=function(e,t){e("td",!0,{filterRule:{children:[t.all_element]},convertRule:function(e){return" "},endRule:function(e){return" |"}}),e("th",!0,{filterRule:{attribute:[{name:"style"}],children:[t.all_element]},convertRule:function(e){return" "},endRule:function(e){return" |"}}),e("tr",!0,{filterRule:{children:[t.all_element]},convertRule:function(e){return"|"},endRule:function(e){return"\n"}}),e("table",!0,{filterRule:{children:[t.all_element]},convertRule:function(e){return""},endRule:function(e){return"\n"}}),e("thead",!0,{filterRule:{children:[t.all_element]},convertRule:function(e){return""},endRule:function(e){const t=e.children[0].children;let n="|";for(let e,r,l=0,i=t.length;l<i;l++){switch(e=t[l],(r=c.formatCSS(e.attribute.style))["text-align"]){case"left":n+=" :---- ";break;case"center":n+=" :----: ";break;case"right":n+=" ----: ";break;default:n+=" ---- "}n+="|"}return`${n}\n`}}),e("tbody",!0,{filterRule:{children:[t.all_element]},convertRule:function(e){return""},endRule:function(e){return""}})},Object.defineProperties(N.prototype,{analysis:{value:function(e){e=c.trim(e),console.time("lexical analysis");const t=[];let n,r=[],l=0,i=0;for(let o,u=0,a=e.length;u<a;u++)switch(o=r.length,n=e[u]){case"<":r.push(n),0===o&&(l=u)-i>1&&!c.isEmpty(e,i+1,l-1)&&t.push(e.slice(i+1,l));break;case">":r.pop(),1===o&&(i=u,t.push(e.slice(l,i+1)))}return console.timeEnd("lexical analysis"),t}}}),Object.defineProperties(k.prototype,{analysis:{value:function(e){if(!c.typeIs(e,c.TYPE.Array))return;console.time("syntactic analysis");const t=[];let n,r,l,i,o,u,a,d;for(let c=e.length;c--;)u=e[c],a=x(e[c]),n=a?u.slice(a.start,a.end):"textNode",r=b[n]||b.htmlNode,i=1&r?3:1===a.start?1:2,l=1&i?_(u,g[r].filterRule.attribute):null,o=1===r?u:null,d={tag:n,type:r,position:i},l&&(d.attribute=l),o&&(d.content=o),t.push(d);return console.timeEnd("syntactic analysis"),t}}}),Object.defineProperties(T.prototype,{build:{value:function(e){const t={tag:"root",type:b.rootNode,position:1},n=[t];let r,l,i,o=t,u=[b.all_element];console.time("virtual dom tree build");for(;r=e.pop();){if(1===r.position){if(!j(e,r,u))continue;n.push(r),u=g[(o=r).type].filterRule.children}else if(2===r.position){if(r.type!==n[n.length-1].type)throw new Error(`opening tag ${n[n.length-1].tag}, closing tag ${r.tag}`);if(r=n.pop(),o=n[n.length-1],l=r.children,(i=l?l.length:0)>0&&(l[i-1].isLast=!0),u=g[o.type].filterRule.children,y.excludeElement[r.type]&&2===y.excludeElement[r.type].option)continue;o.children||(o.children=[]),r.parentNode=o,r.index=o.children.length,o.children.push(r)}else 3===r.position&&(o.children||(o.children=[]),r.parentNode=o,r.index=o.children.length,o.children.push(r));try{(r.type===b.pre||r.type===b.code||r.parentNode&&r.parentNode.isCode)&&(r.isCode=!0)}catch(e){console.error("asd",e,r,r.parentNode)}}return console.timeEnd("virtual dom tree build"),t}}}),Object.defineProperties(w.prototype,{translate:{value:function(e){const t=[];let n,r=e,l="";e._pos=0,console.time("markdown text translate");for(;r!==e||r.children.length>r._pos;)1===r.position?(n=r.children,r!==t[t.length-1]&&(r._pos=0,t.push(r),l+=S(r,"head")),n&&n.length>r._pos?r=n[r._pos++]:(t.pop(),l+=S(r,"tail"),r=t[t.length-1])):3===r.position&&(l+=S(r,"headtail"),r=t[t.length-1]);return console.timeEnd("markdown text translate"),l}}}),Object.defineProperties(E.prototype,{toMarkdown:{value:function(e){this.HTML=c.trim(e);const t=new N,n=new k,r=new T,l=new w;let i=t.analysis(this.HTML);return i=n.analysis(i),i=r.build(i),i=l.translate(i),console.log(i),i}},use:{value:function(e){return e.plugin(m,b,R),this}}}),E.TablePlugin=v;window.console;t.default=E}]).default});